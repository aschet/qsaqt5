<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- ../../src/qsa/qsobjectfactory.cpp -->
<head>
  <title>QSA 1.2: QSObjectFactory Class Reference</title>
    <style type="text/css">h3.fn,span.fn { margin-left: 1cm; text-indent: -1cm; }
a:link { color: #004faf; text-decoration: none }
a:visited { color: #672967; text-decoration: none }
td.postheader { font-family: sans-serif }
tr.address { font-family: sans-serif }
body { background: #ffffff; color: black; }</style>
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="getting-started.html"><font color="#004faf">Tutorial</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">Classes</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a>&nbsp;&middot; <a href="language.html"><font color="#004faf">Language</font></a>&nbsp;&middot; <a href="workbench-reference.html"><font color="#004faf">QSA Workbench</font></a>&nbsp;&middot; <a href="http://doc.trolltech.com/4.1"><font color="#004faf">Qt Documentation</font></a>&nbsp;&middot; <a href="http://www.trolltech.com/"><font color="#004faf">www.trolltech.com</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 class="title">QSObjectFactory Class Reference</h1>
<p>The QSObjectFactory class provides a method for Qt Script programs to create C++ QObjects. <a href="#details">More...</a></p>
<pre>    #include &lt;QSObjectFactory&gt;</pre><p>Inherited by <a href="qsinputdialogfactory.html">QSInputDialogFactory</a> and <a href="qsutilfactory.html">QSUtilFactory</a>.</p>
<ul>
<li><a href="qsobjectfactory-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="public-functions"></a>
<h3>Public Functions</h3>
<ul>
<li><div class="fn"/><b><a href="qsobjectfactory.html#QSObjectFactory">QSObjectFactory</a></b> ()</li>
<li><div class="fn"/>virtual QObject * <b><a href="qsobjectfactory.html#create">create</a></b> ( const QString &amp; <i>name</i>, const QVariantList &amp; <i>arguments</i>, QObject * <i>context</i> )</li>
<li><div class="fn"/>void <b><a href="qsobjectfactory.html#registerClass">registerClass</a></b> ( const QString &amp; <i>className</i>, const QMetaObject * <i>metaObject</i>, QObject * <i>staticDescriptor</i> = 0 )</li>
<li><div class="fn"/>void <b><a href="qsobjectfactory.html#throwError">throwError</a></b> ( const QString &amp; <i>message</i> )</li>
</ul>
<a name="protected-functions"></a>
<h3>Protected Functions</h3>
<ul>
<li><div class="fn"/>QSInterpreter * <b><a href="qsobjectfactory.html#interpreter">interpreter</a></b> () const</li>
</ul>
<a name="details"></a>
<hr />
<h2>Detailed Description</h2>
<p>The QSObjectFactory class provides a method for Qt Script programs to create C++ QObjects.</p>
<p>To enable script programmers to create their own C++ QObjects, application programmers can provide a QObject subclass that has a slot which is a factory function that returns QObjects. Alternatively, the application programmer can subclass QSObjectFactory, reimplement the <a href="qsobjectfactory.html#create">create</a>() function and register the provided classes using the <a href="qsobjectfactory.html#registerClass">registerClass</a>() function.</p>
<p>The <a href="qsobjectfactory.html#registerClass">registerClass</a>() function is called to register to the scripting engine each of the classes that this object factory can instantiate. In addition, the <a href="qsobjectfactory.html#create">create</a>() function is called by the scripting engine to create the instance, i.e&#x2e; when the user writes something like</p>
<pre>    var x = new SomeCppObject( arg1, arg2 ); <span class="comment">// Qt Script</span></pre>
<p>The function <a href="qsobjectfactory.html#create">create</a>() is reimplemented in each QSObjectFactory to provide the an instance of the QObject subclass that describes what the scripter should experience as an object of the type SomeCppObject.</p>
<p>A single QSObjectFactory subclass may be used to provide any number of creatable QObject classes. A QSObjectFactory becomes active when it is added to a <a href="qsinterpreter.html">QSInterpreter</a> using the function <a href="qsinterpreter.html#addObjectFactory">QSInterpreter::addObjectFactory</a>(). An object factory can only be added to one <a href="qsinterpreter.html">QSInterpreter</a> at a time.</p>
<hr />
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QSObjectFactory"></a>QSObjectFactory::QSObjectFactory ()</h3>
<p>Constructor. Creates the object factory. To make the object factory available to an interpreter, use the function: <a href="qsinterpreter.html#addObjectFactory">QSInterpreter::addObjectFactory</a>().</p>
<h3 class="fn"><a name="create"></a>QObject * QSObjectFactory::create ( const QString &amp; <i>name</i>, const QVariantList &amp; <i>arguments</i>, QObject * <i>context</i> )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>This virtual function should be reimplemented in your <a href="qsobjectfactory.html">QSObjectFactory</a> subclass when you want to instantiate objects from script. The subclass can be used to create any number of different classes. The name of the required class is passed in the <i>className</i> argument, and the arguments to be passed to that class's constructor are passed in the <i>arguments</i> list. See QVariant for further information about the arguments. <i>context</i> is the script QObject context in which the class has been instantiated, or 0 if the class has not been instantiated in a QObject context.</p>
<p>Only QObject subclasses may be created in this way. This function returns an instance of the requested class.</p>
<p>This function is called by the scripting engine, e.g&#x2e; when it encounters code similar to the following:</p>
<pre>    var x = new ACppObject( arg1, arg2 ); <span class="comment">// Qt Script</span></pre>
<p>If the arguments are invalid or any other invalid operation happens, you can use <a href="qsobjectfactory.html#throwError">throwError</a>() to issue a Qt Script error.</p>
<p>All objects created from this function are deleted by the engine when the engine registers it as not being referenced anymore, unless the object at this time has a parent, which will then be responsible for ownership.</p>
<h3 class="fn"><a name="interpreter"></a><a href="qsinterpreter.html">QSInterpreter</a> * QSObjectFactory::interpreter () const&nbsp;&nbsp;<tt> [protected]</tt></h3>
<p>Returns the interpreter that this object factory is creating objects for.</p>
<h3 class="fn"><a name="registerClass"></a>void QSObjectFactory::registerClass ( const QString &amp; <i>className</i>, const QMetaObject * <i>metaObject</i>, QObject * <i>staticDescriptor</i> = 0 )</h3>
<p>Registers that this object factory provides the class <i>className</i>.</p>
<p>This function is called once for each of the script classes that a subclass of <a href="qsobjectfactory.html">QSObjectFactory</a> wishes to expose to the scripting engine.</p>
<p>The name <i>className</i> is the name that the class has within the scripting engine. <i>metaObject</i> is used by the interpreter to describe QObjects of returned for <i>className</i> when using syntax completion.</p>
<p>is the name of the C++ class that is actually instantiated when <i>className</i> is passed to the <a href="qsobjectfactory.html#create">create</a>() function. For instance:</p>
<pre><span class="comment">    // in script</span>
    var x = new MyObject();

<span class="comment">    // in C++</span>
    QObject *create( const QString &amp;name, ... ) {
        if( name == &quot;MyObject&quot; )
            return new MyScriptObject()
    }</pre>
<p>Here we would call registerClass as follows:</p>
<pre>    registerClass( &quot;MyObject&quot;, &amp;MyScriptObject::staticMetaObject );</pre>
<p>Providing a null-pointer for <i>metaObject</i> will tell the interpreter that the class is not instantiable.</p>
<p>The <i>staticDescriptor</i> is used to describe the static part of a class. The properties, signals and slots of the <i>staticDescriptor</i> object will be accessible as <i>className</i> 's static part.</p>
<p>For instance, if you want to expose the entire Qt namespace to QSA, it can be done with the following code:</p>
<pre>    class QtNamespace: public QObject
    {
      public:
          const QMetaObject *metaObject()
          {
              return &amp;QObject::staticQtMetaObject;
          }
    };

    class QtNamespaceProvider: public QSObjectFactory
    {
      public:
          QtNamespaceProvider()
          {
              registerClass(&quot;Qt&quot;, 0, new QtNamespace());
          }
    };</pre>
<p>When QtNamespaceProvider is registered with an interpreter, scripts in the interpreter can access the Qt namespace through the class name &quot;Qt&quot;. (Note that the QtNamespace class cannot have a Q_OBJECT macro, as this macro also declares the metaObject() method.)</p>
<h3 class="fn"><a name="throwError"></a>void QSObjectFactory::throwError ( const QString &amp; <i>message</i> )</h3>
<p>Informs the interpreter that an error has occurred. The error is treated like a normal Qt Script error. The error message is passed in <i>message</i>.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2008 <a href="http://www.trolltech.com">Trolltech</a></td>
<td width="40%" align="center"><a href="http://www.trolltech.com/company/copyright.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">QSA 1.2.3</div></td>
</tr></table></div></address></body>
</html>
