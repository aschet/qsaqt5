<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- ../../src/qsa/qswrapperfactory.cpp -->
<head>
  <title>QSA 1.2: QSWrapperFactory Class Reference</title>
    <style type="text/css">h3.fn,span.fn { margin-left: 1cm; text-indent: -1cm; }
a:link { color: #004faf; text-decoration: none }
a:visited { color: #672967; text-decoration: none }
td.postheader { font-family: sans-serif }
tr.address { font-family: sans-serif }
body { background: #ffffff; color: black; }</style>
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="getting-started.html"><font color="#004faf">Tutorial</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">Classes</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a>&nbsp;&middot; <a href="language.html"><font color="#004faf">Language</font></a>&nbsp;&middot; <a href="workbench-reference.html"><font color="#004faf">QSA Workbench</font></a>&nbsp;&middot; <a href="http://doc.trolltech.com/4.1"><font color="#004faf">Qt Documentation</font></a>&nbsp;&middot; <a href="http://www.trolltech.com/"><font color="#004faf">www.trolltech.com</font></a></td>
<td align="right" valign="top" width="230"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></td></tr></table><h1 class="title">QSWrapperFactory Class Reference</h1>
<p>The QSWrapperFactory class provides a method for Qt Script to extend QObject C++ types and to automatically wrap non-QObject C++ types. <a href="#details">More...</a></p>
<pre>    #include &lt;QSWrapperFactory&gt;</pre><ul>
<li><a href="qswrapperfactory-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="public-functions"></a>
<h3>Public Functions</h3>
<ul>
<li><div class="fn"/><b><a href="qswrapperfactory.html#QSWrapperFactory">QSWrapperFactory</a></b> ()</li>
<li><div class="fn"/>virtual QObject * <b><a href="qswrapperfactory.html#create">create</a></b> ( const QString &amp; <i>className</i>, void * <i>ptr</i> ) = 0</li>
<li><div class="fn"/>void <b><a href="qswrapperfactory.html#registerWrapper">registerWrapper</a></b> ( const QString &amp; <i>className</i>, const QString &amp; <i>cppClassName</i> = QString::null )</li>
<li><div class="fn"/>void <b><a href="qswrapperfactory.html#throwError">throwError</a></b> ( const QString &amp; <i>message</i> )</li>
</ul>
<a name="protected-functions"></a>
<h3>Protected Functions</h3>
<ul>
<li><div class="fn"/>QSInterpreter * <b><a href="qswrapperfactory.html#interpreter">interpreter</a></b> () const</li>
</ul>
<a name="details"></a>
<hr />
<h2>Detailed Description</h2>
<p>The QSWrapperFactory class provides a method for Qt Script to extend QObject C++ types and to automatically wrap non-QObject C++ types.</p>
<p>If a C++ object which is available to Qt Script returns a pointer of a non-QObject type, by default Qt Script can't wrap it dynamically. It can store the pointer and pass it on, but no functions can be called on the object. The QSWrapperFactory class provides a means of making non-QObject types properly accessible from Qt Script.</p>
<p>The way QSWrapperFactory achieves this is that when a non-QObject pointer is returned, the Qt Script interpreter tries to find a wrapper for that type. A wrapper is a QObject which can wrap the non-QObject type and which makes the non-QObject type's slots, properties, etc. available to Qt Script.</p>
<p>In some cases even a QObject might need to be wrapped. For example, we might want to use a QObject subclass's functions which are not declared as slots in Qt Script. Qt Script only makes the slots, signals and properties of QObjects available. With QSWrapperFactory it is possible to define a QObject which extends another QObject with additional slots, properties, and signals.</p>
<p>To make use of this method, wrap the classes you want to make available or want to extend (see the example below). You then create a QSWrapperFactory (wrapper factory) subclass. You register your wrapper factory (or factories) with the Qt Script interpreter. When the interpreter needs an instance of a class, it checks the registered wrapper factories to see if the class has a suitable wrapper.</p>
<p>Call <a href="qswrapperfactory.html#registerWrapper">registerWrapper</a>() for each class that this instance of QSWrapperFactory can wrap. Reimplement <a href="qswrapperfactory.html#create">create</a>() to create a wrapper for a certain type. Finally, create an instance of the QSWrapperFactory and add it to an interpreter.</p>
<p>The following code is an example of how to make a non-QObject C++ type known to Qt Script. We create a wrapper for a class called Process that provides a function called exec(). We then create a wrapper factory which we'll register with the interpreter. You can wrap as many classes as you like and make them all available through a single wrapper factory (although you can use as many wrapper factories as you like).</p>
<p>The created wrapper is deleted by the interpreter as at some point after that the interpreter determines that there are no more references to the wrapped type from script.</p>
<pre>    class ProcessWrapper : public QObject
    {
        Q_OBJECT
    public:
        ProcessWrapper( Process *p ) : proc( p ) {}
    public slots:
        void exec( const QString &amp;args ) { proc-&gt;exec( args ); }
    private:
        Process *proc;
    };

    class WrapperFactory : public QSWrapperFactory
    {
    public:
        WrapperFactory()
        {
            registerWrapper( &quot;Process&quot;, &quot;ProcessWrapper&quot; );
        }

        QObject *create( const QString &amp;className, void *ptr ) {
            if ( className == &quot;Process&quot; )
                return new ProcessWrapper( (Process*)ptr );
            return 0;
        }
    };</pre>
<p>Somewhere in your code, before executing any QSA related functionality, you must instantiate an instance of our new wrapper.</p>
<pre>    interpreter-&gt;addWrapperFactory( new WrapperFactory() );</pre>
<p>Now, whenever Qt Script comes across a Process pointer, it will look through its wrapper factories to find one that provides a wrapper for the Process class and wrap it (e.g&#x2e; with ProcessWrapper). So the script writer will now be able to use all the slots, properties, and signals that ProcessWrapper provides.</p>
<p>To <i>extend</i> a QObject C++ type, you do exactly the same process: i.e&#x2e; wrap the class in a class that exposes the required functionality, put the wrapper in a wrapper factory, and register the wrapper factory with the interpreter.</p>
<hr />
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QSWrapperFactory"></a>QSWrapperFactory::QSWrapperFactory ()</h3>
<p>This constructor creates a wrapper factory. To make the wrapper factory available to an interpreter, use <a href="qsinterpreter.html#addWrapperFactory">QSInterpreter::addWrapperFactory</a>()</p>
<p>See also <a href="qsinterpreter.html#addWrapperFactory">QSInterpreter::addWrapperFactory</a>().</p>
<h3 class="fn"><a name="create"></a>QObject * QSWrapperFactory::create ( const QString &amp; <i>className</i>, void * <i>ptr</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>This function is called by the Qt Script interpreter to request a wrapper for the type <i>className</i>. <i>ptr</i> is a pointer to the instance of the type <i>className</i>. The <i>ptr</i> will be passed to its related wrapper function and an instance of the wrapper will be returned.</p>
<p>Reimplement this function to make your wrappers available from your wrapper factory.</p>
<p>If <i>ptr</i> is invalid or any other invalid operation occurs, you can use <a href="qswrapperfactory.html#throwError">throwError</a>() to issue a Qt Script error.</p>
<h3 class="fn"><a name="interpreter"></a><a href="qsinterpreter.html">QSInterpreter</a> * QSWrapperFactory::interpreter () const&nbsp;&nbsp;<tt> [protected]</tt></h3>
<p>Returns the interpreter that this wrapper factory is creating objects for.</p>
<h3 class="fn"><a name="registerWrapper"></a>void QSWrapperFactory::registerWrapper ( const QString &amp; <i>className</i>, const QString &amp; <i>cppClassName</i> = QString::null )</h3>
<p>Registers that this factory provides a wrapper for the type <i>className</i>. The <i>cppClassName</i> variable tells the engine which C++ class is used to represent it. This is used for better completion. <i>cppClassName</i> can be null (the default) in which case the engine assumes that the script class and C++ implementation both have the same name.</p>
<h3 class="fn"><a name="throwError"></a>void QSWrapperFactory::throwError ( const QString &amp; <i>message</i> )</h3>
<p>Informs the interpreter that an error has occurred. The error is treated like a normal Qt Script error. The error message is passed in <i>message</i>.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2008 <a href="http://www.trolltech.com">Trolltech</a></td>
<td width="40%" align="center"><a href="http://www.trolltech.com/company/copyright.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">QSA 1.2.3</div></td>
</tr></table></div></address></body>
</html>
